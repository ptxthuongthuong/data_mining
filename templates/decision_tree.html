{% extends "base_algorithm.html" %}
{% block algorithm_content %}
<div class="decision-tree-container">
    <h2>Decision Tree Configuration</h2>

    <!-- Form for Decision Tree Options -->
    <form id="decision-tree-options" method="POST">
        <!-- Radio buttons for choosing Gini or Gain -->
        <div>
            <label><input type="radio" name="criterion" value="gini" checked> Gini</label>
            <label><input type="radio" name="criterion" value="entropy"> Gain</label>
        </div>

        <!-- Select columns and target column -->
        <div class="form-group">
            <label for="target_column">Chọn cột mục tiêu:</label>
            <select id="target_column" name="target_column" class="form-control">
                {% for column in dataset_info.columns %}
                    <option value="{{ column }}">{{ column }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Macro for selecting feature columns -->
        {% from "components.html" import select_columns %}
        {{ select_columns(dataset_info.columns, "selected_columns") }}

        <!-- Submit button -->
        <button type="submit" class="btn btn-primary">Run Decision Tree</button>
    </form>

    <!-- Tree Visualization -->
    <div id="tree-visualization">
        <h3>Decision Tree</h3>
        <div id="tree-graph"></div>
    </div>

    <!-- Node Information Table -->
    <div id="node-info">
        <h3>Node Information</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Node</th>
                    <th>Feature</th>
                    <th>Threshold</th>
                    <th>Impurity</th>
                    <th>Samples</th>
                </tr>
            </thead>
            <tbody id="node-details"></tbody>
        </table>
    </div>
</div>

<script>
document.getElementById('decision-tree-options').addEventListener('submit', function (e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch('/run_decision_tree', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
            return;
        }

        // Cập nhật cây quyết định
        document.getElementById('tree-graph').innerHTML = data.tree_graph;

        // Cập nhật bảng thông tin node
        const nodeDetailsBody = document.getElementById('node-details');
        nodeDetailsBody.innerHTML = ''; // Xóa nội dung cũ
        data.tree_info.forEach(node => {
            const row = `
                <tr>
                    <td>${node.node}</td>
                    <td>${node.feature}</td>
                    <td>${node.threshold || 'N/A'}</td>
                    <td>${node.impurity.toFixed(4)}</td>
                    <td>${node.samples}</td>
                </tr>
            `;
            nodeDetailsBody.innerHTML += row;
        });
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Đã xảy ra lỗi trong quá trình xử lý.');
    });
});
</script>
{% endblock %}
